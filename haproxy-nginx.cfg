global
    maxconn 50000
    nbproc 1
    nbthread 4
    cpu-map auto:1/1-4 0-3
    tune.bufsize 32768
    tune.maxrewrite 8192
    tune.ssl.default-dh-param 2048

defaults
    mode http
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    option httplog
    option dontlognull
    option http-server-close
    option forwardfor
    option redispatch
    retries 3
    maxconn 10000

frontend http_front
    bind *:80
    stats enable
    stats uri /haproxy-stats
    stats refresh 10s
    default_backend nginx_servers

backend nginx_servers
    balance roundrobin
    option httpchk GET /health
    server nginx-1 nginx-1:80 check maxconn 5000
    server nginx-2 nginx-2:80 check maxconn 5000